import{t as H,a as S}from"./D1PqDKWF.js";import{i as X}from"./PUnCc7Gg.js";import{z as Z,y as N,A as B,B as ee,a0 as O,a1 as R,m as p,F as W,C as T,D,a2 as te}from"./Ks_cNANK.js";import{s as q}from"./BjRtELmc.js";import{_ as re,i as G}from"./BYkJfY_W.js";import{o as ne,a as se}from"./DNvaIBBB.js";/*! Capacitor: https://capacitorjs.com/ - MIT License */var A;(function(r){r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE"})(A||(A={}));class K extends Error{constructor(e,t,o){super(e),this.message=e,this.code=t,this.data=o}}const oe=r=>{var e,t;return r!=null&&r.androidBridge?"android":!((t=(e=r==null?void 0:r.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},ie=r=>{const e=r.CapacitorCustomPlatform||null,t=r.Capacitor||{},o=t.Plugins=t.Plugins||{},n=()=>e!==null?e.name:oe(r),s=()=>n()!=="web",l=c=>{const g=h.get(c);return!!(g!=null&&g.platforms.has(n())||i(c))},i=c=>{var g;return(g=t.PluginHeaders)===null||g===void 0?void 0:g.find(x=>x.name===c)},f=c=>r.console.error(c),h=new Map,$=(c,g={})=>{const x=h.get(c);if(x)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),x.proxy;const L=n(),w=i(c);let v;const k=async()=>(!v&&L in g?v=typeof g[L]=="function"?v=await g[L]():v=g[L]:e!==null&&!v&&"web"in g&&(v=typeof g.web=="function"?v=await g.web():v=g.web),v),U=(a,u)=>{var y,C;if(w){const _=w==null?void 0:w.methods.find(P=>u===P.name);if(_)return _.rtype==="promise"?P=>t.nativePromise(c,u.toString(),P):(P,F)=>t.nativeCallback(c,u.toString(),P,F);if(a)return(y=a[u])===null||y===void 0?void 0:y.bind(a)}else{if(a)return(C=a[u])===null||C===void 0?void 0:C.bind(a);throw new K(`"${c}" plugin is not implemented on ${L}`,A.Unimplemented)}},d=a=>{let u;const y=(...C)=>{const _=k().then(P=>{const F=U(P,a);if(F){const M=F(...C);return u=M==null?void 0:M.remove,M}else throw new K(`"${c}.${a}()" is not implemented on ${L}`,A.Unimplemented)});return a==="addListener"&&(_.remove=async()=>u()),_};return y.toString=()=>`${a.toString()}() { [capacitor code] }`,Object.defineProperty(y,"name",{value:a,writable:!1,configurable:!1}),y},m=d("addListener"),b=d("removeListener"),E=(a,u)=>{const y=m({eventName:a},u),C=async()=>{const P=await y;b({eventName:a,callbackId:P},u)},_=new Promise(P=>y.then(()=>P({remove:C})));return _.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await C()},_},j=new Proxy({},{get(a,u){switch(u){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?E:m;case"removeListener":return b;default:return d(u)}}});return o[c]=j,h.set(c,{name:c,proxy:j,platforms:new Set([...Object.keys(g),...w?[L]:[]])}),j};return t.convertFileSrc||(t.convertFileSrc=c=>c),t.getPlatform=n,t.handleError=f,t.isNativePlatform=s,t.isPluginAvailable=l,t.registerPlugin=$,t.Exception=K,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},ae=r=>r.Capacitor=ie(r),I=ae(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),z=I.registerPlugin;class Q{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let o=!1;this.listeners[e]||(this.listeners[e]=[],o=!0),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),o&&this.sendRetainedArgumentsForEvent(e);const l=async()=>this.removeListener(e,t);return Promise.resolve({remove:l})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,o){const n=this.listeners[e];if(!n){if(o){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}n.forEach(s=>s(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:o=>{this.notifyListeners(t,o)}}}unimplemented(e="not implemented"){return new I.Exception(e,A.Unimplemented)}unavailable(e="not available"){return new I.Exception(e,A.Unavailable)}async removeListener(e,t){const o=this.listeners[e];if(!o)return;const n=o.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(o=>{this.notifyListeners(e,o)}))}}const J=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),V=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ce extends Q{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(o=>{if(o.length<=0)return;let[n,s]=o.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=V(n).trim(),s=V(s).trim(),t[n]=s}),t}async setCookie(e){try{const t=J(e.key),o=J(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),l=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${o||""}${n}; path=${s}; ${l};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}z("CapacitorCookies",{web:()=>new ce});const le=async r=>new Promise((e,t)=>{const o=new FileReader;o.onload=()=>{const n=o.result;e(n.indexOf(",")>=0?n.split(",")[1]:n)},o.onerror=n=>t(n),o.readAsDataURL(r)}),de=(r={})=>{const e=Object.keys(r);return Object.keys(r).map(n=>n.toLocaleLowerCase()).reduce((n,s,l)=>(n[s]=r[e[l]],n),{})},ue=(r,e=!0)=>r?Object.entries(r).reduce((o,n)=>{const[s,l]=n;let i,f;return Array.isArray(l)?(f="",l.forEach(h=>{i=e?encodeURIComponent(h):h,f+=`${s}=${i}&`}),f.slice(0,-1)):(i=e?encodeURIComponent(l):l,f=`${s}=${i}`),`${o}&${f}`},"").substr(1):null,fe=(r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),n=de(r.headers)["content-type"]||"";if(typeof r.data=="string")t.body=r.data;else if(n.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[l,i]of Object.entries(r.data||{}))s.set(l,i);t.body=s.toString()}else if(n.includes("multipart/form-data")||r.data instanceof FormData){const s=new FormData;if(r.data instanceof FormData)r.data.forEach((i,f)=>{s.append(f,i)});else for(const i of Object.keys(r.data))s.append(i,r.data[i]);t.body=s;const l=new Headers(t.headers);l.delete("content-type"),t.headers=l}else(n.includes("application/json")||typeof r.data=="object")&&(t.body=JSON.stringify(r.data));return t};class ge extends Q{async request(e){const t=fe(e,e.webFetchExtra),o=ue(e.params,e.shouldEncodeUrlParams),n=o?`${e.url}?${o}`:e.url,s=await fetch(n,t),l=s.headers.get("content-type")||"";let{responseType:i="text"}=s.ok?e:{};l.includes("application/json")&&(i="json");let f,h;switch(i){case"arraybuffer":case"blob":h=await s.blob(),f=await le(h);break;case"json":f=await s.json();break;case"document":case"text":default:f=await s.text()}const $={};return s.headers.forEach((c,g)=>{$[g]=c}),{data:f,headers:$,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}z("CapacitorHttp",{web:()=>new ge});function pe(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(o,n){return(s,l,i)=>{const f=r.Capacitor.Plugins[t];if(f===void 0){i(new Error(`Capacitor plugin ${t} not found`));return}if(typeof f[n]!="function"){i(new Error(`Method ${n} not found in Capacitor plugin ${t}`));return}(async()=>{try{const h=await f[n](s);l(h)}catch(h){i(h)}})()}}})}})}function he(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return r.cordova.plugins[t]}})}function ve(r=!1){window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!r?pe(window):window.cordova!==void 0&&he(window)}const Y=z("Geolocation",{web:()=>re(()=>import("./Bd-8ZpBE.js"),[],import.meta.url).then(r=>new r.GeolocationWeb)});ve();var me=H("<p><strong>Dispositivo:</strong> Móvil 📱</p>"),we=H("<p><strong>Dispositivo:</strong> Escritorio 💻</p>"),ye=H('<pre class="svelte-qvirs3"> </pre>'),be=H('<div class="error-box svelte-qvirs3"><h3> </h3> <!> <!></div>'),Pe=H("<!> <p> </p> <p> </p>",1);function Oe(r,e){Z(e,!1);let t=R(""),o=R(""),n=R(null),s=null;const l=12;let i=R(!1);ne(async()=>{O(i,I.isNativePlatform());async function w(){var d;try{const m=p(i)?{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}:{},b=await Y.getCurrentPosition(m);if(O(t,b.coords.latitude.toString()),O(o,b.coords.longitude.toString()),!k(p(t),p(o)))throw{message:"Coordenadas inválidas en móvil",details:{lat:p(t),lon:p(o),isMobile:p(i)}};const E=await fetch(`https://proyectomascotas.onrender.com/update_coordenadas_discapacitado/${l}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({latitud:p(t),longitud:p(o)})});if(!E.ok)throw await U(E);console.log("Ubicación actualizada correctamente"),O(n,null)}catch(m){O(n,{message:m.message||"Error en móvil",details:m.details||m}),console.error("Error en móvil:",JSON.stringify(p(n),null,2)),p(i)&&((d=m.message)!=null&&d.includes("Timeout"))&&await v()}}async function v(){try{console.warn("Intentando obtener ubicación por red...");const d=await Y.getCurrentPosition({enableHighAccuracy:!1});O(t,d.coords.latitude.toString()),O(o,d.coords.longitude.toString())}catch(d){console.error("Error alternativo:",d)}}function k(d,m){const b=parseFloat(d),E=parseFloat(m);return!isNaN(b)&&!isNaN(E)&&b>=-90&&b<=90&&E>=-180&&E<=180}async function U(d){const m=await d.json().catch(()=>({}));return{status:d.status,statusText:d.statusText,serverError:m,url:d.url,message:`Error ${d.status}: ${d.statusText}`}}w(),s=setInterval(w,15e3)}),se(()=>clearInterval(s)),X();var f=Pe(),h=N(f);{var $=w=>{var v=be(),k=T(v),U=T(k,!0);D(k);var d=W(k,2);{var m=a=>{var u=me();S(a,u)},b=a=>{var u=we();S(a,u)};G(d,a=>{p(i)?a(m):a(b,!1)})}var E=W(d,2);{var j=a=>{var u=ye(),y=T(u,!0);D(u),B(C=>q(y,C),[()=>JSON.stringify(p(n).details.serverError,null,2)],te),S(a,u)};G(E,a=>{p(n).details.serverError&&a(j)})}D(v),B(()=>q(U,p(n).message)),S(w,v)};G(h,w=>{p(n)&&w($)})}var c=W(h,2),g=T(c);D(c);var x=W(c,2),L=T(x);D(x),B(()=>{q(g,`Latitud: ${p(t)||"Obteniendo..."}`),q(L,`Longitud: ${p(o)||"Obteniendo..."}`)}),S(r,f),ee()}export{Q as W,Oe as _};
