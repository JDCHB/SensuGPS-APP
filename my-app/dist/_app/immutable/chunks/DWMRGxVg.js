import{t as F,a as A,d as J}from"./D1PqDKWF.js";import{i as ee}from"./PUnCc7Gg.js";import{z as te,y as re,A as G,B as se,a0 as j,a1 as M,m as h,F as _,C as O,D as U,a2 as ne}from"./Ks_cNANK.js";import{s as R}from"./BjRtELmc.js";import{_ as oe,i as W}from"./BYkJfY_W.js";import{o as ae,a as ie}from"./DNvaIBBB.js";/*! Capacitor: https://capacitorjs.com/ - MIT License */var D;(function(r){r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE"})(D||(D={}));class K extends Error{constructor(e,t,o){super(e),this.message=e,this.code=t,this.data=o}}const ce=r=>{var e,t;return r!=null&&r.androidBridge?"android":!((t=(e=r==null?void 0:r.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},le=r=>{const e=r.CapacitorCustomPlatform||null,t=r.Capacitor||{},o=t.Plugins=t.Plugins||{},s=()=>e!==null?e.name:ce(r),n=()=>s()!=="web",d=c=>{const u=w.get(c);return!!(u!=null&&u.platforms.has(s())||i(c))},i=c=>{var u;return(u=t.PluginHeaders)===null||u===void 0?void 0:u.find(T=>T.name===c)},g=c=>r.console.error(c),w=new Map,S=(c,u={})=>{const T=w.get(c);if(T)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),T.proxy;const P=s(),x=i(c);let E;const q=async()=>(!E&&P in u?E=typeof u[P]=="function"?E=await u[P]():E=u[P]:e!==null&&!E&&"web"in u&&(E=typeof u.web=="function"?E=await u.web():E=u.web),E),B=(a,f)=>{var p,C;if(x){const L=x==null?void 0:x.methods.find(v=>f===v.name);if(L)return L.rtype==="promise"?v=>t.nativePromise(c,f.toString(),v):(v,y)=>t.nativeCallback(c,f.toString(),v,y);if(a)return(p=a[f])===null||p===void 0?void 0:p.bind(a)}else{if(a)return(C=a[f])===null||C===void 0?void 0:C.bind(a);throw new K(`"${c}" plugin is not implemented on ${P}`,D.Unimplemented)}},m=a=>{let f;const p=(...C)=>{const L=q().then(v=>{const y=B(v,a);if(y){const $=y(...C);return f=$==null?void 0:$.remove,$}else throw new K(`"${c}.${a}()" is not implemented on ${P}`,D.Unimplemented)});return a==="addListener"&&(L.remove=async()=>f()),L};return p.toString=()=>`${a.toString()}() { [capacitor code] }`,Object.defineProperty(p,"name",{value:a,writable:!1,configurable:!1}),p},b=m("addListener"),k=m("removeListener"),H=(a,f)=>{const p=b({eventName:a},f),C=async()=>{const v=await p;k({eventName:a,callbackId:v},f)},L=new Promise(v=>p.then(()=>v({remove:C})));return L.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await C()},L},l=new Proxy({},{get(a,f){switch(f){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?H:b;case"removeListener":return k;default:return m(f)}}});return o[c]=l,w.set(c,{name:c,proxy:l,platforms:new Set([...Object.keys(u),...x?[P]:[]])}),l};return t.convertFileSrc||(t.convertFileSrc=c=>c),t.getPlatform=s,t.handleError=g,t.isNativePlatform=n,t.isPluginAvailable=d,t.registerPlugin=S,t.Exception=K,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},de=r=>r.Capacitor=le(r),I=de(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),z=I.registerPlugin;class X{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let o=!1;this.listeners[e]||(this.listeners[e]=[],o=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),o&&this.sendRetainedArgumentsForEvent(e);const d=async()=>this.removeListener(e,t);return Promise.resolve({remove:d})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,o){const s=this.listeners[e];if(!s){if(o){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}return}s.forEach(n=>n(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:o=>{this.notifyListeners(t,o)}}}unimplemented(e="not implemented"){return new I.Exception(e,D.Unimplemented)}unavailable(e="not available"){return new I.Exception(e,D.Unavailable)}async removeListener(e,t){const o=this.listeners[e];if(!o)return;const s=o.indexOf(t);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(o=>{this.notifyListeners(e,o)}))}}const V=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Y=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ue extends X{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(o=>{if(o.length<=0)return;let[s,n]=o.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=Y(s).trim(),n=Y(n).trim(),t[s]=n}),t}async setCookie(e){try{const t=V(e.key),o=V(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),d=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${o||""}${s}; path=${n}; ${d};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}z("CapacitorCookies",{web:()=>new ue});const fe=async r=>new Promise((e,t)=>{const o=new FileReader;o.onload=()=>{const s=o.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},o.onerror=s=>t(s),o.readAsDataURL(r)}),ve=(r={})=>{const e=Object.keys(r);return Object.keys(r).map(s=>s.toLocaleLowerCase()).reduce((s,n,d)=>(s[n]=r[e[d]],s),{})},ge=(r,e=!0)=>r?Object.entries(r).reduce((o,s)=>{const[n,d]=s;let i,g;return Array.isArray(d)?(g="",d.forEach(w=>{i=e?encodeURIComponent(w):w,g+=`${n}=${i}&`}),g.slice(0,-1)):(i=e?encodeURIComponent(d):d,g=`${n}=${i}`),`${o}&${g}`},"").substr(1):null,pe=(r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),s=ve(r.headers)["content-type"]||"";if(typeof r.data=="string")t.body=r.data;else if(s.includes("application/x-www-form-urlencoded")){const n=new URLSearchParams;for(const[d,i]of Object.entries(r.data||{}))n.set(d,i);t.body=n.toString()}else if(s.includes("multipart/form-data")||r.data instanceof FormData){const n=new FormData;if(r.data instanceof FormData)r.data.forEach((i,g)=>{n.append(g,i)});else for(const i of Object.keys(r.data))n.append(i,r.data[i]);t.body=n;const d=new Headers(t.headers);d.delete("content-type"),t.headers=d}else(s.includes("application/json")||typeof r.data=="object")&&(t.body=JSON.stringify(r.data));return t};class he extends X{async request(e){const t=pe(e,e.webFetchExtra),o=ge(e.params,e.shouldEncodeUrlParams),s=o?`${e.url}?${o}`:e.url,n=await fetch(s,t),d=n.headers.get("content-type")||"";let{responseType:i="text"}=n.ok?e:{};d.includes("application/json")&&(i="json");let g,w;switch(i){case"arraybuffer":case"blob":w=await n.blob(),g=await fe(w);break;case"json":g=await n.json();break;case"document":case"text":default:g=await n.text()}const S={};return n.headers.forEach((c,u)=>{S[u]=c}),{data:g,headers:S,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}z("CapacitorHttp",{web:()=>new he});function me(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(o,s){return(n,d,i)=>{const g=r.Capacitor.Plugins[t];if(g===void 0){i(new Error(`Capacitor plugin ${t} not found`));return}if(typeof g[s]!="function"){i(new Error(`Method ${s} not found in Capacitor plugin ${t}`));return}(async()=>{try{const w=await g[s](n);d(w)}catch(w){i(w)}})()}}})}})}function we(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return r.cordova.plugins[t]}})}function be(r=!1){window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!r?me(window):window.cordova!==void 0&&we(window)}const Q=z("Geolocation",{web:()=>oe(()=>import("./94Tjl3R6.js"),[],import.meta.url).then(r=>new r.GeolocationWeb)});be();var ye=F('<div class="error-details svelte-sp074"><strong>Detalles del servidor:</strong> <pre> </pre></div>'),Pe=F('<div class="error-box svelte-sp074" role="alert"><h3 class="svelte-sp074"> </h3> <p class="device-info svelte-sp074"><strong>Dispositivo:</strong> <!></p> <!></div>'),Ee=F('<div class="status success svelte-sp074">‚úÖ Ubicaci√≥n enviada correctamente</div>'),Ce=F('<div class="status loading svelte-sp074">‚åõ Enviando ubicaci√≥n...</div>'),Le=F('<!> <div class="location-info svelte-sp074" role="status"><h2 class="svelte-sp074">üìç Ubicaci√≥n actual</h2> <p class="svelte-sp074"><strong>Latitud:</strong> </p> <p class="svelte-sp074"><strong>Longitud:</strong> </p> <!></div>',1);function Ae(r,e){te(e,!1);let t=M(""),o=M(""),s=M(null),n=null;const d=12;let i=M(!1);ae(async()=>{j(i,I.isNativePlatform());async function m(){var l;try{const a=h(i)?{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}:{},f=await Q.getCurrentPosition(a);if(j(t,f.coords.latitude.toString()),j(o,f.coords.longitude.toString()),!k(h(t),h(o)))throw{message:"Coordenadas inv√°lidas en m√≥vil",details:{lat:h(t),lon:h(o),isMobile:h(i)}};const p=await fetch(`https://proyectomascotas.onrender.com/update_coordenadas_discapacitado/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({latitud:h(t),longitud:h(o)})});if(!p.ok)throw await H(p);console.log("Ubicaci√≥n actualizada correctamente"),j(s,null)}catch(a){j(s,{message:a.message||"Error en m√≥vil",details:a.details||a}),console.error("Error en m√≥vil:",JSON.stringify(h(s),null,2)),h(i)&&((l=a.message)!=null&&l.includes("Timeout"))&&await b()}}async function b(){try{console.warn("Intentando obtener ubicaci√≥n por red...");const l=await Q.getCurrentPosition({enableHighAccuracy:!1});j(t,l.coords.latitude.toString()),j(o,l.coords.longitude.toString())}catch(l){console.error("Error alternativo:",l)}}function k(l,a){const f=parseFloat(l),p=parseFloat(a);return!isNaN(f)&&!isNaN(p)&&f>=-90&&f<=90&&p>=-180&&p<=180}async function H(l){const a=await l.json().catch(()=>({}));return{status:l.status,statusText:l.statusText,serverError:a,url:l.url,message:`Error ${l.status}: ${l.statusText}`}}m(),n=setInterval(m,15e3)}),ie(()=>clearInterval(n)),ee();var g=Le(),w=re(g);{var S=m=>{var b=Pe(),k=O(b),H=O(k);U(k);var l=_(k,2),a=_(O(l),2);{var f=v=>{var y=J("M√≥vil üì±");A(v,y)},p=v=>{var y=J("Escritorio üíª");A(v,y)};W(a,v=>{h(i)?v(f):v(p,!1)})}U(l);var C=_(l,2);{var L=v=>{var y=ye(),$=_(O(y),2),Z=O($,!0);U($),U(y),G(N=>R(Z,N),[()=>JSON.stringify(h(s).details.serverError,null,2)],ne),A(v,y)};W(C,v=>{h(s).details.serverError&&v(L)})}U(b),G(()=>R(H,`‚ùå ${h(s).message??""}`)),A(m,b)};W(w,m=>{h(s)&&m(S)})}var c=_(w,2),u=_(O(c),2),T=_(O(u));U(u);var P=_(u,2),x=_(O(P));U(P);var E=_(P,2);{var q=m=>{var b=Ee();A(m,b)},B=m=>{var b=Ce();A(m,b)};W(E,m=>{h(t)&&h(o)?m(q):m(B,!1)})}U(c),G(()=>{R(T,` ${h(t)||"Obteniendo ubicaci√≥n..."}`),R(x,` ${h(o)||"Obteniendo ubicaci√≥n..."}`)}),A(r,g),se()}export{X as W,Ae as _};
